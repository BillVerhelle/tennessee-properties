import React, { useState, useEffect } from 'react';
import { Star, ExternalLink, Info, ChevronLeft, ChevronRight, Home, MapPin, DollarSign, Bed, Bath, Square } from 'lucide-react';

const NashvilleRealEstate = () => {
  const [properties, setProperties] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [selectedProperty, setSelectedProperty] = useState(null);
  const [showDetails, setShowDetails] = useState(false);
  
  const PROPERTIES_PER_PAGE = 75;
  
  // Properties of interest from your document
  const propertiesOfInterest = [
    '7045 Lanceleaf Dr, College Grove, TN 37046',
    '6004 Pelican Way, College Grove, TN 37046',
    '6045 Native Pony Trl, College Grove, TN 37046',
    '8500 Heirloom Blvd, College Grove, TN 37046',
    '8135 Heirloom Blvd, College Grove, TN 37046',
    '8524 Heirloom Blvd, College Grove, TN 37046',
    '9052 Passiflora Ct, College Grove, TN 37046',
    '391 The Lady Of The Lake Ln, Franklin, TN 37067',
    '1005 Scramblers Knob, Franklin, TN 37069',
    '1420 Amesbury Ln, Franklin, TN 37069',
    '1807 Morgan Farms Way, Brentwood, TN 37027',
    '305 Lockhart Ct, Franklin, TN 37069',
    '6128 Lookaway Cir LOT 208, Franklin, TN 37067',
    '8100 Turning Point Dr LOT 14, Brentwood, TN 37027',
    '8103 Turning Point Dr LOT 12, Brentwood, TN 37027',
    '7116 Bonterra Dr, Franklin, TN 37064',
    '1013 Buena Vista Dr, Franklin, TN 37069',
    '5603 Winslet Dr, Franklin, TN 37064',
    '9222 Lehigh Dr, Brentwood, TN 37027',
    '460 Tinnan Ave, Franklin, TN 37067'
  ];

  // Generate mock data for demonstration (in production, this would come from Zillow API)
  useEffect(() => {
    const generateMockProperties = () => {
      const mockData = [];
      const cities = ['Nashville', 'Brentwood', 'Franklin', 'College Grove'];
      const streets = ['Oak', 'Maple', 'Elm', 'Pine', 'Cedar', 'Birch', 'Willow', 'Cherry'];
      
      // Add properties of interest first
      propertiesOfInterest.forEach((address, index) => {
        mockData.push({
          id: `special-${index}`,
          address: address,
          price: 2000000 + Math.random() * 3000000,
          beds: Math.floor(Math.random() * 3) + 3,
          baths: Math.floor(Math.random() * 2) + 2.5,
          sqft: Math.floor(Math.random() * 3000) + 3500,
          image: `https://picsum.photos/400/300?random=${index}`,
          zillowUrl: `https://www.zillow.com/homedetails/${index}`,
          isInterest: true,
          description: 'Luxury estate property with premium finishes and amenities'
        });
      });
      
      // Generate additional properties to reach 375 total
      for (let i = propertiesOfInterest.length; i < 375; i++) {
        const city = cities[Math.floor(Math.random() * cities.length)];
        const street = streets[Math.floor(Math.random() * streets.length)];
        mockData.push({
          id: `prop-${i}`,
          address: `${1000 + i} ${street} ${Math.random() > 0.5 ? 'Dr' : 'Ln'}, ${city}, TN ${37000 + Math.floor(Math.random() * 100)}`,
          price: 2000000 + Math.random() * 3000000,
          beds: Math.floor(Math.random() * 3) + 3,
          baths: Math.floor(Math.random() * 2) + 2.5,
          sqft: Math.floor(Math.random() * 3000) + 3500,
          image: `https://picsum.photos/400/300?random=${i}`,
          zillowUrl: `https://www.zillow.com/homedetails/${i}`,
          isInterest: false,
          description: 'Beautiful home in prime location with modern amenities'
        });
      }
      
      // Sort by price (low to high)
      return mockData.sort((a, b) => a.price - b.price);
    };

    // Simulate API call
    setTimeout(() => {
      try {
        const data = generateMockProperties();
        setProperties(data);
        setLoading(false);
      } catch (err) {
        setError('Failed to load properties');
        setLoading(false);
      }
    }, 1000);
  }, []);

  const totalPages = Math.ceil(properties.length / PROPERTIES_PER_PAGE);
  const startIndex = (currentPage - 1) * PROPERTIES_PER_PAGE;
  const endIndex = startIndex + PROPERTIES_PER_PAGE;
  const currentProperties = properties.slice(startIndex, endIndex);

  const formatPrice = (price) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(price);
  };

  const PropertyCard = ({ property }) => {
    const isPropertyOfInterest = propertiesOfInterest.some(addr => 
      property.address.toLowerCase().includes(addr.toLowerCase())
    );

    return (
      <div className="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]">
        {isPropertyOfInterest && (
          <div className="bg-gradient-to-r from-yellow-400 to-yellow-500 text-black px-3 py-1 flex items-center justify-center">
            <Star className="w-4 h-4 mr-1 fill-current" />
            <span className="text-xs font-semibold">Property of Interest</span>
          </div>
        )}
        <div className="relative">
          <img 
            src={property.image} 
            alt={property.address}
            className="w-full h-48 object-cover"
          />
          <div className="absolute top-3 left-3 bg-black/70 text-white px-3 py-1 rounded-full">
            <span className="text-sm font-semibold">{formatPrice(property.price)}</span>
          </div>
        </div>
        
        <div className="p-4">
          <div className="flex items-start justify-between mb-3">
            <h3 className="text-sm font-semibold text-gray-900 line-clamp-2 flex-1">
              {property.address}
            </h3>
          </div>
          
          <div className="flex items-center gap-4 text-xs text-gray-600 mb-4">
            <div className="flex items-center gap-1">
              <Bed className="w-3 h-3" />
              <span>{property.beds} beds</span>
            </div>
            <div className="flex items-center gap-1">
              <Bath className="w-3 h-3" />
              <span>{property.baths} baths</span>
            </div>
            <div className="flex items-center gap-1">
              <Square className="w-3 h-3" />
              <span>{property.sqft.toLocaleString()} sqft</span>
            </div>
          </div>
          
          <div className="flex gap-2">
            <a
              href={property.zillowUrl}
              target="_blank"
              rel="noopener noreferrer"
              className="flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-1 text-sm font-medium"
            >
              <ExternalLink className="w-3 h-3" />
              Zillow
            </a>
            <button
              onClick={() => {
                setSelectedProperty(property);
                setShowDetails(true);
              }}
              className="flex-1 bg-gray-200 text-gray-900 py-2 px-3 rounded-lg hover:bg-gray-300 transition-colors flex items-center justify-center gap-1 text-sm font-medium"
            >
              <Info className="w-3 h-3" />
              Details
            </button>
          </div>
        </div>
      </div>
    );
  };

  const PropertyDetailsModal = ({ property, onClose }) => {
    if (!property) return null;

    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
            <h2 className="text-xl font-semibold">Property Details</h2>
            <button
              onClick={onClose}
              className="text-gray-500 hover:text-gray-700 text-2xl leading-none"
            >
              ×
            </button>
          </div>
          
          <div className="p-6">
            <img 
              src={property.image} 
              alt={property.address}
              className="w-full h-64 object-cover rounded-xl mb-6"
            />
            
            <div className="space-y-4">
              <div>
                <h3 className="text-2xl font-bold text-gray-900 mb-2">{formatPrice(property.price)}</h3>
                <p className="text-gray-600 flex items-center gap-2">
                  <MapPin className="w-4 h-4" />
                  {property.address}
                </p>
              </div>
              
              <div className="grid grid-cols-3 gap-4 py-4 border-y">
                <div className="text-center">
                  <Bed className="w-6 h-6 mx-auto mb-1 text-gray-600" />
                  <p className="text-lg font-semibold">{property.beds}</p>
                  <p className="text-sm text-gray-600">Bedrooms</p>
                </div>
                <div className="text-center">
                  <Bath className="w-6 h-6 mx-auto mb-1 text-gray-600" />
                  <p className="text-lg font-semibold">{property.baths}</p>
                  <p className="text-sm text-gray-600">Bathrooms</p>
                </div>
                <div className="text-center">
                  <Square className="w-6 h-6 mx-auto mb-1 text-gray-600" />
                  <p className="text-lg font-semibold">{property.sqft.toLocaleString()}</p>
                  <p className="text-sm text-gray-600">Square Feet</p>
                </div>
              </div>
              
              <div>
                <h4 className="font-semibold mb-2">Description</h4>
                <p className="text-gray-600">{property.description}</p>
              </div>
              
              <div className="pt-4">
                <a
                  href={property.zillowUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-medium"
                >
                  <ExternalLink className="w-4 h-4" />
                  View on Zillow
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Loading properties...</p>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center text-red-600">
          <p className="text-xl mb-2">Error</p>
          <p>{error}</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm sticky top-0 z-40">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="py-6">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold">
                BV
              </div>
              <div>
                <h1 className="text-2xl font-bold text-gray-900">
                  Bill & Cyndee Verhelle's Preferred Properties
                </h1>
                <p className="text-sm text-gray-600">
                  Property Search Agent developed by Bill Verhelle
                </p>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* Stats Bar */}
      <div className="bg-blue-600 text-white py-3">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between text-sm">
            <span>Showing {startIndex + 1}-{Math.min(endIndex, properties.length)} of {properties.length} properties</span>
            <span>Sorted by: Price (Low to High)</span>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Property Grid */}
        <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
          {currentProperties.map((property) => (
            <PropertyCard key={property.id} property={property} />
          ))}
        </div>

        {/* Pagination */}
        <div className="flex items-center justify-center gap-2">
          <button
            onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
            disabled={currentPage === 1}
            className="p-2 rounded-lg bg-white shadow hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all"
          >
            <ChevronLeft className="w-5 h-5" />
          </button>
          
          {[...Array(totalPages)].map((_, index) => (
            <button
              key={index}
              onClick={() => setCurrentPage(index + 1)}
              className={`px-3 py-1 rounded-lg transition-all ${
                currentPage === index + 1
                  ? 'bg-blue-600 text-white'
                  : 'bg-white shadow hover:shadow-md'
              }`}
            >
              {index + 1}
            </button>
          ))}
          
          <button
            onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
            disabled={currentPage === totalPages}
            className="p-2 rounded-lg bg-white shadow hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all"
          >
            <ChevronRight className="w-5 h-5" />
          </button>
        </div>
      </main>

      {/* Footer */}
      <footer className="bg-gray-900 text-white py-8 mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <p className="text-sm">© Bill & Cyndee Verhelle, All Rights Reserved</p>
        </div>
      </footer>

      {/* Property Details Modal */}
      {showDetails && (
        <PropertyDetailsModal 
          property={selectedProperty} 
          onClose={() => {
            setShowDetails(false);
            setSelectedProperty(null);
          }}
        />
      )}
    </div>
  );
};

export default NashvilleRealEstate;
